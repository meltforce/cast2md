{% extends "base.html" %}

{% block title %}Settings - Transcriber Node{% endblock %}

{% block content %}
<hgroup>
    <h1>Settings</h1>
    <p>{{ config.name if config else 'Unknown Node' }}</p>
</hgroup>

{% if saved %}
<article style="background: #d4edda; border-color: #c3e6cb;">
    <p style="margin: 0; color: #155724;">Settings saved. Restart the node worker to apply whisper changes.</p>
</article>
{% endif %}

{% if not config %}
<article>
    <header>
        <h3>Not Configured</h3>
    </header>
    <p>This node is not registered with a server.</p>
    <p>Run <code>cast2md node register --server &lt;server_url&gt; --name "Node Name"</code> to register.</p>
</article>
{% else %}

<article>
    <header>
        <h3>System Information</h3>
    </header>
    <table>
        <tbody>
            <tr>
                <td><strong>Platform</strong></td>
                <td>{{ system_info.platform }} ({{ system_info.machine }})</td>
            </tr>
            <tr>
                <td><strong>Processor</strong></td>
                <td>{{ system_info.processor }}</td>
            </tr>
            <tr>
                <td><strong>CPU Cores</strong></td>
                <td>{{ system_info.cpu_count }}</td>
            </tr>
            {% if system_info.memory_gb %}
            <tr>
                <td><strong>Memory</strong></td>
                <td>{{ system_info.memory_gb }} GB</td>
            </tr>
            {% endif %}
        </tbody>
    </table>
</article>

<form method="post" action="/settings">
<article>
    <header>
        <h3>Whisper Configuration</h3>
    </header>
    <div class="grid">
        <label>
            Model
            <select name="whisper_model">
                {% for value, label in whisper_models %}
                <option value="{{ value }}" {% if settings.whisper_model == value %}selected{% endif %}>{{ label }}</option>
                {% endfor %}
            </select>
        </label>
        <label>
            Backend
            <select name="whisper_backend">
                {% for value, label in whisper_backends %}
                <option value="{{ value }}" {% if settings.whisper_backend == value %}selected{% endif %}>{{ label }}</option>
                {% endfor %}
            </select>
        </label>
    </div>
    <small>Changes require a node restart to take effect.</small>
</article>

<article>
    <header>
        <h3>Node Configuration</h3>
    </header>
    <label>
        Server URL
        <input type="url" name="server_url" value="{{ config.server_url }}" required>
    </label>
    <table>
        <tbody>
            <tr>
                <td><strong>Node ID</strong></td>
                <td><code style="font-size: 0.85em;">{{ config.node_id }}</code></td>
            </tr>
            <tr>
                <td><strong>Name</strong></td>
                <td>{{ config.name }}</td>
            </tr>
        </tbody>
    </table>
</article>

<button type="submit">Save Settings</button>
</form>

{% endif %}
{% endblock %}
